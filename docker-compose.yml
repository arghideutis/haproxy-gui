version: '3.8'

services:
  web:
    image: ghcr.io/arghideutis/haproxy-gui:latest
    build: .
    command: gunicorn --bind 0.0.0.0:8000 app:app --workers 3
    volumes:
      # - ./:/app # uncomment for development to enable live code reloading
      # Mount host auth files so PAM inside the container can validate host accounts.
      # WARNING: this exposes sensitive host files to the container. Use with extreme caution.
      - /etc/passwd:/etc/passwd:ro
      - /etc/group:/etc/group:ro
      - /etc/shadow:/etc/shadow:ro
      - /etc/pam.d:/etc/pam.d:ro
      - /etc/nsswitch.conf:/etc/nsswitch.conf:ro
      - /etc/haproxy/haproxy.cfg:/app/haproxy.cfg # Mount a default HAProxy config for testing. Remove or replace with a custom config as needed.
    expose:
      - "8000"
    environment:
      - PYTHONUNBUFFERED=1

  nginx:
    image: nginx:stable-alpine
    ports:
      - "8085:80"
    volumes:
      - ./docker/nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./static:/app/static:ro
    depends_on:
      - web
